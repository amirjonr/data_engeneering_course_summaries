Что такое OLTP (Online transaction processing) система (нагрузка) ?
 - появились 50-60 ые годы 20 века.
 - быстрое обслуживание относительно простых запросов большого числа пользователей, при этом время выполнения не должно превышать
 ( микро-, милли-) секунд
 Примеры: отправка сообщений, оплата и тп.

 Что такое OLAP (Online analytical processing) система (нагрузка) ?
 - имеет дело с историческими данными или архивами. Характеризуется относительно низким объемом сложных запросов
  и включают много таблиц. Такие запросы как прибыл компании в прошлом году.


В общем, данные из OLTP системы попадают в OLAP системы, на базе которых создаются отчеты и тп.

OLTP системы, это современная микросервисная архитектура.
Сравнение:
#######################################################################################################################
                                  #         OLAP                          #        OLTP
Формат хранения:                  # Единый, согласованный                 # Варьируется от задач.
Допущение избыточности:           # Контролируемая избыточность           # Максимальная нормализация
Управление данными                # Переодическое добавление данных       # CRUD operations в любое время
Количество хранимых данных        # Должны быть доступны все данные       # Только оперативные данные (без исторических)
Характер запросов к данным        # Произвольные запросы (ad hoc анализ)  # Заранее составленные запросы.
#######################################################################################################################

Их невозможно использовать в одном месте. Хранилище данных появились от разницы этих систем.
Хранилище данных. Определение:
 1) Предметная ориентированность - для принятия решений требуется некоторая строго определнная совокупность данных,
 которая вытаскивается из БД в ХД, втростепенные атрибуты отсеиваются.
 2) Интегрированность - устранение несоответствий внутри данных.
 3) Временная привязка - содержит данные за большой интервал времени (от 5-7 до 10 лет)
 4) Неразрушаемая совокупность данных - модификация данных не производится, поскольку может привести к нарушению
 их целостности.
 5) Набор данных, организованный для целей поддержки принятия решений.


Хранилище данных:
OLTP (CRM, ERP, CBS) -> OLAP (DWH) -> (operational reporting, data vizualization, predictive analytics)

Слои данных в DWH ( Primary Data Layer, Core Layer, Data Mart Layer)
1) Primary Data Layer - Первичный слой(raw or staging) на котором выполняется загрузка информации из систем-источников,
в исходном качестве и сохранением полной истории изменений.
На этом слое происходит абстрагирование следующих слоев хранилища от физического устройства источников данных,
способов их сбора и методов выделения изменений.
Простыми словами мы делаем данные удобными для нашей системы или трансформация данных
2) Core layer - ядро, здесь мы консолидируем данных из разных источников, приводя их к единым структурам и ключам.
Здесь происходит основная работа с качеством данных и происходят трансформации.
3) Data Mart Layer - слой витрин, данные переобразуются к структурам удобным для анализа и других системах-потребителей.
этот слой представляет собой срез КХД в виде массива тематической, узконаправленной информации, ориентированного,
например на пользователей одной рабочей группы или департамента.
Например: Таблица фактов по продажам, что, кому, как?

#####################################################################################################################
Подходы по проектированию хранилище данных:

1) По Кимбалу:
Это копия наших транзакционных данных, специально структурированных для запроса и анализа в виде витрин данных.
DWH - это набор витрин под потребителей
Проектирование снизу вверх:
    Анализ потребностей - узнаем какие отчеты нужны,
    Анализ источников - узнаем в каких источниках есть данные
    Проектируем витрину под конкретного потребителя
    Первичные данные из источников преобразуются в витрины
Core Layer не обязателен
Преимущества:
    Быстрый эффект, достаточного поэтапного анализа на бизнес областей, не требует высококвалифицированных
    специалистов.
Недостатки:
    Высокая стоимость поддержки новых источников, отсутствие стандартизации показателей (у каждой витрины свой алгоритм)


1) По Инмону:
DWH - это корпоративное централизованное хранилище данных
Проектирование сверху вниз:
    Тщательный анализ бизнеса в целом
    Выявляется бизнес области
    В них бизнес сущности
    Затем - их характеристики (атрибуты) и связи между ними.
    Например для сервиса такси это: клиенты, поездки, машины, водители и тп.
В общем, в результате анализа появляется понимание какие сущности участвуют в бизнес процессах и как они
взаимодействуют друг с другом.
Core Layer обязателен
Преимущества:
    Единая версия правды, Отсутствие противоречивости, легко поддерживать при увелечении качества источников.
Недостатки:
    Сложная в реализации, долгая, нужна высококласная команда.

#####################################################################################################################

Аналитическое хранилище данных (DWH):
    - только полезные данные, актуальные в текущем периоде времени.
    - четко структурированные данные одного формата
    - низкая гибкость, структура и тип придумываются заранее и не подлежат изменению в процессе эксплуатации
    - процесс извлечения проходит быстро
    - достаточно высокая стоимость проектирования из-за сложности.

Чтобы решить проблему аналитических хранилище данных создали озера данных (Data Lake):
    - хранилище большого объема неструктурированных данных, собратнных или генерированных одной компанией
    - храниться все данные, в т ч и бесполезные которые могут понадобиться в будущем или никогда не понадобиться
    - структурированные, полуструктурированные, и неструктурированные разнородные данные любых форматов:
     от мультимедиа до текстовых и бинарных из разных источников
    - высокая гибкость, которая в процессу эксплуатации добавлять новые типы и структуры данных
    - из за отсутствия четкой структуры необходима их дополнительная обработка для их практического использования
    - дешевле чем DWH с точки зрения проектирования

users -> (OLTP) - > Data Lake -> DWH -> (Reports, data vizual-n, analyt)
Стрелочки (->) это ETL процессы.
Пакетная и Потоковая обработка ETL процессов.

Пакетная:
 - данные доставляются с задрежкой
 - простая разработка и тестирование
 - высокая эффективность для OLAP систем
 - пиковая нагрузка на железо

Потоковая:
 - результать в режиме реального времени
 - сложная разработка и тестирование
 - низкая эффектиновсть для OLAP систем
 - равномерная нагрузка на железо

Lambda architecture:

              real-time layer (stream process) -> (real time views)
    new logs ->                                                                         -> data access
              batch layer (primary data layer -> core layer) -> (data mart layer)


Kappa architecture:
  new logs-> real-time layer (stream process) -> (real time views) -> data access


###############################################################################################################

Нормальные формы:
 Данные зависят
   - от ключа -> 1НФ
   - от всего ключа -> 2НФ
   - ничего кроме ключа -> 3НФ
6 НФ - время фиксации факта
#################################################################################################################

Dimensional Modeling - пространственное моделирование.

1)fact tables - таблица фактов, является основоной таблицей хранилища данных, содержит инфу о событиях, объектах
или процессах которые в дальнейшем будет использоваться

2)dimensional tables - таблица измерений, таблица в которых храниться атрибуты событий, обектов которые
есть в таблице фактов

Модел "Звезда":
    модель которая представляется двумя видами таблиц: факты и измерения, которые описывают факты
Moдeл "Снежинка":
    отличается от звезды тем что используется нормализованные данные, то есть таблицы измерений разветвляются на отдельные
    таблицы измерений. Недостатком является сложность запросов (join -ы)
Модел "Созвездие":
    модел созвездие получается от соединения несольких таблицы фактов, которые связаны по какой то логике.

Таблица фактов:
 - Содержит числовые параметры, метрики
 - Каждая таблица фактов имеет составной ключ, состоящих из первычный ключей таблицы измерений.
 Виды фактов:
    аддитивные - если имеет смысл использовать с любыми измерениями для выполнения операций суммирования с целью
  получения какого либо значимого результата. Например: кол-во продаж, объем продаж и т.д. Аддитивные факты
  можно суммировать по всем измерениям.
    полуаддитивные - есть смысл суммировать с некоторыми измерениями.
    неаддитивные - не имеет смысла суммировать ни по каким измерениям
    числовые меры интенсивности - факт является таковым если он является неаддитивным по времени, но допускает аггрегацию
    по некоторому числу временных переодов, например, остаток на счете


Свойства таблицы фактов:
 - числовые параметры используются для аггрегации и суммирования
 - значение должны обладать свойствами аддитивности или полуаддитивности чтобы их можно было аггрегировать
 - все данные должны иметь связь с таблицами измерений чтобы обеспечить доступ к ним через таблицы измерений

 Таким образом таблицу фактов можно разделить на две части: первычные ключи таблицей измерений и числовые параметры
 которые функционально зависимы от ключей таблиц измерений.


 Виды таблицы фактов:
    Транзакционная - факты, которые описывают определенные события. Например, продажа товара
    Снапшоты - факты, которые фиксируют состояние определенного направления бизнеса за данные период времени.
  Например, продажа товаров на определенную дату (ежедневно)
    Кумулятивные снапшоты - итоговое состояние на данный момент времени, промежуточные итоги.
  Например, продажи этого года на определенную дату.

Таблицы измерений:
 - dimensional tabel or dim table, таблица которая содержит атрибуты событий, сохраненных в таблице фактов,
   и имеет первичный ключ и атрибуты.

   Характеристики:
       содержат данные о детализации фактов
       содержат атрибуты фактов
       как правило в них есть много полей
       меньше строк чем в таблице фактов
       обычно используется при визуализации данных в отчетах и запросах
   Виды:
       Медленно меняющимся измерениями (SCD - Slowly Changing Dimensions) - таблицы в которых
       некоторые атрибуты могут изменить свои значения по истечении некоторого периода времени
       Всего существует 8 видов SCD, которые определяют как история изменений должна
       быть сохранена.
       Быстро меняющимся измерениями - (Fast Changing Dimensions) - измерения разбиваются на две
       сущности, один из них содержит аттрибуты которые меняются быстро, а другие медленно.

   Виды SCD:
   0) No change to attribute value - original value only
   1) Overwrite attribute value - only current value
   2) Add new dimension row to profile with new attribute value - add new row
   3) Add new column to preserve attribute's current and prior values - add column for prior values
   4) Add mini-dimensional table containing rapidly changing attributes
   6) Combinations of scd1 + scd2 + scd3

